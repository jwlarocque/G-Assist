# Home Assistant Plugin for NVIDIA G-Assist

## Prerequisites

- G-Assist
- A Home Assistant server
  - The server must be accessible from the PC running G-Assist
- Python (3.13 or later recommended)

## Home Assistant MCP Server Installation

Install the [Model Context Protocol Server plugin for Home Assistant](https://www.home-assistant.io/integrations/mcp_server/). We'll be using HTTP transport, so you do not need a stdio proxy.  
(Note: you do not *need* a separate MCP client, as this plugin takes that role, but you may want to install one for testing.)  

[Generate a long-lived access token](https://www.home-assistant.io/integrations/mcp_server/#long-lived-access-tokens) and save it for later. 

(Optional) With the MCP client of your choice, verify that tool calls to Home Assistant are working.

## Plugin Installation

Clone or download this repository:  
```
git clone https://github.com/jwlarocque/G-Assist.git
cd G-Assist/plugins/home-assistant
```

Run the first-time setup script:
```
setup.bat
```

Open `config.json.example` with the text editor of your choice.  
Fill in your MCP server URL and access token from the MCP server installation above.  
**SAVE AS** `config.json`.

Run the build script:
```
build.bat
```


Create this folder (if G-Assist is installed, all but the `home-assistant` directory should already exist):  
```
"%programdata%\NVIDIA Corporation\nvtopps\rise\plugins\home-assistant"
```

Copy `home-assistant-plugin.exe`, `manifest_template.json`, `manifest.json`, and `config.json` from the `G-Assist/plugins/home-assistant/dist/home-assistant` folder (inside the repo you cloned earlier - these were generated by `build.bat`) into that new folder.

### Registering new devices

If you modify your Home Assistant to add (or remove) devices, you can make this plugin aware of the changes by doing either of the following:

* Re-run `build.bat` as described above, and copy the files to the `rise/plugins/home-assistant` directory again, replacing the old versions.  Then, restart G-Assist.
* Ask G-Assist to refresh the manifest: `Hey home-assistant, call refresh_manifest.`  Then, restart G-Assist.

### Disabling functionality

For performance reasons, you may wish to disable some of the functionality of this plugin. (This will reduce the amount of information G-Assist has to handle, which may improve both the speed and reliability of the remaining functions.)  
To do so, open `G-Assist/plugins/home-assistant/manifest_consts.py`.  Scroll down to `ALLOWED_TOOLS` and remove the entire entry for any functionality you don't need.  (See the Functionality section below for an overview of each function.)

## Usage

Open G-Assist and start your prompt with `Hey home-assistant` or `/home-assistant`, followed by your command. For best results, mention the exact name of a device on your Home Assistant server.

For example:

* `Hey home-assistant, turn on the Living Room Fan`
* `/home-assistant add an Nvidia GB200 to my Shopping List`
* `/home-assistant using GetLiveContext, what song is currently playing on the Bedroom media player?`
* `/home-assistant start the ground floor vacuum`
* `/home-assistant search for "Crab Rave" and play it on the Walkman media player`
* `/home-assistant set the Office RGBW Lights color to "blue"`

### Logs

This plugin will log any errors to `%USERPROFILE%\home-assistant-plugin.log`, usually.

### Functionality

The following functions are supported (provided they're set up in your Home Assistant).  You may use their full name when asking G-Assist to invoke them, but do not need to.  
To see which functions are supported by your current installation, inspect `manifest.json` as generated in the instructions above.

* HassTurnOn
    * Turns on/opens/presses a device or entity. For locks, this performs a 'lock' action. Use for requests like 'turn on', 'activate', 'enable', or 'lock'.
* HassTurnOff
    * Turns off/closes a device or entity. For locks, this performs an 'unlock' action. Use for requests like 'turn off', 'deactivate', 'disable', or 'unlock'.
* HassSetPosition
    * Sets the position of a device or entity
* HassCancelAllTimers
    * Cancels all timers
* HassListAddItem
    * Add item to a todo list
* HassClimateSetTemperature
    * Sets the target temperature of a climate device or entity
* HassFanSetSpeed
    * Sets a fan's speed by percentage
* HassHumidifierSetpoint
    * Set desired humidity level
* HassLightSet
    * Sets the brightness percentage or color of a light
* HassMediaUnpause
    * Resumes a media player
* HassMediaPause
    * Pauses a media player
* HassMediaNext
    * Skips a media player to the next item
* HassMediaPrevious
    * Replays the previous item for a media player
* HassSetVolume
    * Sets the volume percentage of a media player
* HassSetVolumeRelative
    * Increases or decreases the volume of a media player
* HassMediaPlayerMute
    * Mutes a media player
* HassMediaPlayerUnmute
    * Unmutes a media player
* HassMediaSearchAndPlay
    * Searches for media and plays the first result
* HassVacuumStart
    * Starts a vacuum
* HassVacuumReturnToBase
    * Returns a vacuum to base
* GetDateTime
    * Provides the current date and time.
* todo\_get\_items
    * Query a to-do list to find out what items are on it. Use this to answer questions like 'What's on my task list?' or 'Read my grocery list'. Filters items by status (needs\_action, completed, all).
* GetLiveContext
    * Provides real-time information about the CURRENT state, value, or mode of devices, sensors, entities, or areas. Use this tool for: 1. Answering questions about current conditions (e.g., 'Is the light on?'). 2. As the first step in conditional actions (e.g., 'If the weather is rainy, turn off sprinklers' requires checking the weather first).
    * Note: this function returns information for _all_ devices at once.
* refresh_manifest
    * Refreshes the manifest as described above. (Changes are only applied after G-Assist is restarted.)